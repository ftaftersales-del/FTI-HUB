<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FTHOTLINE - Gestione Ticket</title>

  <link rel="stylesheet" href="ftstyle.css" />
  <link rel="stylesheet" href="fthotline.css" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-storage-compat.js"></script>
  <script src="firebase-config.js"></script>
</head>

<body class="ft-page has-topbar">
  <!-- TOPBAR (v6) -->
  <div class="ft-topbar">
    <div class="ft-topbar__inner">
      <div class="ft-topbar__left">
        <a href="/FTI-HUB/FTHUBAS.html" class="ft-home-btn">‚Üê HOME</a>
        <div>
          <div class="ft-topbar__brand">FTHOTLINE</div>
          <div class="ft-topbar__subtitle">Gestione Ticket</div>
        </div>
      </div>

      <div class="ft-topbar__center">
        <div class="ft-topbar__userinfo">
          Utente: <span id="currentUserInfo">Caricamento utente...</span>
        </div>
      </div>

      <div class="ft-topbar__right">
        <!-- spazio libero (azioni future se vuoi) -->
      </div>
    </div>
  </div>

  <!-- LAYOUT -->
  <div class="ht-layout">
    <!-- SINISTRA -->
    <aside class="ht-left panel">
      <div class="ht-filters section">
        <input
          id="searchInput"
          type="text"
          placeholder="Cerca per codice, oggetto, VIN, targa..."
        />

        <select id="statusFilter">
          <option value="">Tutti gli stati</option>
          <option value="open_waiting_distributor">Aperto - in attesa distributore</option>
          <option value="open_waiting_dealer">Aperto - in attesa dealer</option>
          <option value="closed">Chiuso</option>
        </select>

        <select id="departmentFilter">
          <option value="">Tutti i reparti</option>
        </select>

        <select id="authorFilter">
          <option value="">Tutti gli autori</option>
        </select>

        <button id="btnNewTicket" class="btn btn-primary btn-wide">
          Nuovo ticket
        </button>
      </div>

      <div id="ticketsList" class="ht-tickets section"></div>

      <button id="btnLoadMoreTickets" class="btn btn-wide">
        Carica altri
      </button>
    </aside>

    <!-- DESTRA -->
    <main class="ht-right panel">
      <div id="noTicketSelectedMessage" class="muted ht-empty">
        Nessun ticket selezionato. Seleziona un ticket dalla lista o creane uno nuovo.
      </div>

      <!-- HEADER -->
      <section id="ticketHeaderContent" class="section ht-ticket-header" style="display:none;">
        <div class="ht-grid ht-grid-6">
          <div class="ht-field">
            <label>Codice ticket</label>
            <input id="ticketCode" type="text" readonly />
          </div>

          <div class="ht-field">
            <label>Oggetto</label>
            <input id="ticketSubject" type="text" readonly />
          </div>

          <div class="ht-field">
            <label>Dealer</label>
            <input id="ticketDealer" type="text" readonly />
          </div>

          <div class="ht-field">
            <label>Creato da</label>
            <input id="ticketCreator" type="text" readonly />
          </div>

          <div class="ht-field">
            <label>Data creazione</label>
            <input id="ticketCreatedAt" type="text" readonly />
          </div>

          <div class="ht-field">
            <label>Stato</label>
            <div>
              <span id="ticketStatusBadge" class="badge ht-status-badge ht-status-open">-</span>
            </div>
          </div>
        </div>

        <div class="ht-grid ht-grid-6">
          <div class="ht-field">
            <label>VIN</label>
            <input id="ticketVin" type="text" readonly />
          </div>

          <div class="ht-field">
            <label>Targa</label>
            <input id="ticketPlate" type="text" readonly />
          </div>

          <div class="ht-field">
            <label>Km</label>
            <input id="ticketKm" type="text" readonly />
          </div>

          <div class="ht-field">
            <label>Ore motore</label>
            <input id="ticketEngineHours" type="text" readonly />
          </div>

          <div class="ht-field">
            <label>Reparto</label>
            <select id="ticketDepartment" disabled></select>
          </div>

          <div class="ht-field ht-field-actions">
            <button id="btnCloseTicket" class="btn btn-danger">
              Chiudi ticket
            </button>
          </div>
        </div>
      </section>

      <!-- BODY + CHAT -->
      <section id="ticketBodyContainer" class="ht-ticket-body" style="display:none;">
        <div class="section">
          <div class="section-head">
            <h3 class="section-title">Richiesta</h3>
          </div>
          <div id="ticketBodyText" class="ht-box"></div>
        </div>

        <div class="section">
          <div class="section-head">
            <h3 class="section-title">Richiesta di garanzia</h3>
          </div>
          <div id="ticketWarrantyRequestText" class="ht-box"></div>
        </div>

        <div class="section ht-chat">
          <div class="section-head">
            <h3 class="section-title">Chat</h3>
            <div class="section-sub">Risposte e allegati</div>
          </div>

          <div id="chatMessages" class="ht-chat-messages"></div>

          <div class="ht-chat-input">
            <textarea id="chatMessageInput" placeholder="Scrivi una risposta..."></textarea>
            <input id="chatFileInput" type="file" multiple />
            <button id="btnSendMessage" class="btn btn-primary">Invia</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- MODAL NUOVO TICKET -->
  <div id="newTicketModal" class="ht-modal-backdrop">
    <div class="ht-modal panel">
      <div class="ht-modal-header">Nuovo ticket Hotline</div>

      <div class="ht-modal-body">
        <div class="ht-modal-row">
          <label for="newTicketSubject">Oggetto *</label>
          <input id="newTicketSubject" type="text" />
        </div>

        <div class="ht-modal-row">
          <label for="newTicketDepartment">Reparto *</label>
          <select id="newTicketDepartment">
            <option value="">Seleziona reparto</option>
          </select>
        </div>

        <div class="ht-modal-row">
          <label for="newTicketVin">VIN</label>
          <input id="newTicketVin" type="text" />
        </div>

        <div class="ht-modal-row">
          <label for="newTicketPlate">Targa</label>
          <input id="newTicketPlate" type="text" />
        </div>

        <div class="ht-modal-row">
          <label for="newTicketKm">Km</label>
          <input id="newTicketKm" type="number" min="0" />
        </div>

        <div class="ht-modal-row">
          <label for="newTicketEngineHours">Ore motore</label>
          <input id="newTicketEngineHours" type="number" min="0" />
        </div>

        <div class="ht-modal-row">
          <label for="newTicketWarranty">Richiesta di garanzia</label>
          <textarea id="newTicketWarranty"></textarea>
        </div>

        <div class="ht-modal-row">
          <label for="newTicketBody">Descrizione richiesta *</label>
          <textarea id="newTicketBody"></textarea>
        </div>

        <div id="newTicketError" class="ht-error"></div>

        <div class="ht-modal-footer">
          <button id="newTicketCancel" class="btn">Annulla</button>
          <button id="newTicketSubmit" class="btn btn-primary">Invia</button>
        </div>
      </div>
    </div>
  </div>

  <script src="FTHOTLINE.js"></script>
</body>
</html>
